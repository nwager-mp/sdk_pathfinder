(this.webpackJsonpsdk_pathfinder=this.webpackJsonpsdk_pathfinder||[]).push([[0],{15:function(t,e,n){},17:function(t,e,n){},18:function(t,e,n){},20:function(t,e,n){},21:function(t,e,n){"use strict";n.r(e);var r=n(4),a=n.n(r),s=n(9),i=n.n(s),o=(n(15),n(0)),c=n.n(o),u=n(2),p=n(10),h=n(3),d=n(5),l=n(7),f=n(6),v=function(t,e){return new Promise((function(n,r){var a=setInterval(function(){var r=Object(u.a)(c.a.mark((function r(){var s,i,o;return c.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(s=null,!(s=t instanceof HTMLIFrameElement?t:document.getElementById(t))){r.next=7;break}return r.next=5,s.contentWindow;case 5:(i=r.sent.MP_SDK)&&(clearInterval(a),o=i.connect(s,e,"3.2"),n(o));case 7:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}(),100)}))},w=(n(17),n(18),n(1)),b=function(t){Object(l.a)(n,t);var e=Object(f.a)(n);function n(){return Object(h.a)(this,n),e.apply(this,arguments)}return Object(d.a)(n,[{key:"render",value:function(){return Object(w.jsx)("div",{className:"frame",children:Object(w.jsx)("iframe",{id:this.props.id||"showcase",className:"frame",src:this.props.src,title:"showcase",allowFullScreen:!0,frameBorder:"0"})})}}]),n}(r.Component);n(20);function m(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)+Math.pow(t.z-e.z,2))}function y(t,e){return e[t].position}var j=function(t){Object(l.a)(n,t);var e=Object(f.a)(n);function n(t){var r;return Object(h.a)(this,n),(r=e.call(this,t)).sweeps={},r.state={optionsElements:[]},r}return Object(d.a)(n,[{key:"componentDidUpdate",value:function(t){var e=this;t!==this.props&&(this.props.sweepData.map((function(t){return e.sweeps[t.sid]=t})),this.renderOptions().then((function(t){e.setState({optionsElements:t})})))}},{key:"renderOptions",value:function(){var t=Object(u.a)(c.a.mark((function t(){var e,n,r,a,s,i,o,u;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(e=this.props.currSweepId,n=this.sweeps,r=[],a=0,s=Object.keys(n);a<s.length;a++)i=s[a],o=void 0,e&&(u=n[i].position,o=m(n[e].position,u)),r.push({id:i,distance:o});return t.abrupt("return",r.map((function(t){return Object(w.jsx)("option",{value:t.id,children:t.id+(t.distance?" (".concat(Math.round(t.distance),"m)"):"")},t.id)})));case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t=this.props,e=t.selectedSweepId,n=t.onChange,r=this.state.optionsElements;return Object(w.jsx)("div",{className:"menu",children:Object(w.jsxs)("select",{onChange:n,value:e,children:[Object(w.jsx)("option",{value:"",children:"--"}),r]})})}}]),n}(r.Component),k=function(){function t(e){var n=this;Object(h.a)(this,t),this.VERT_THRESHOLD=.5,this.HORZ_THRESHOLD=10,this.graph={},this.path=[],this.sweepPositions={},e.map((function(t){return n.sweepPositions[t.sid]=t.position})),this.createGraph(e)}return Object(d.a)(t,[{key:"createGraph",value:function(t){for(var e={},n=0;n<t.length;n++){for(var r=t[n],a={},s=r.neighbors,i=0;i<s.length;i++){var o=s[i],c=m(r.position,this.sweepPositions[o]);a[o]=c}e[r.sid]=a}this.graph=e}},{key:"heuristic",value:function(t,e){var n=this.sweepPositions;return m(n[t],n[e])}},{key:"penalty",value:function(t,e){var n=this.sweepPositions;return Math.pow((n[t].y-n[e].y)/this.VERT_THRESHOLD,4)+(Math.pow(n[t].x-n[e].x,2)+Math.pow(n[t].z-n[e].z,2))/this.HORZ_THRESHOLD}},{key:"findShortestPath",value:function(){var t=Object(u.a)(c.a.mark((function t(e,n){var r,a,s,i,o,u,p,h,d,l,f,v,w,b;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this.graph,console.log(e,n),void 0!==r[e]&&void 0!==r[n]){t.next=5;break}return console.error("Sweep SID(s) is invalid."),t.abrupt("return");case 5:(a={})[e]={visited:!1,distance:0,cost:0,parent:null},s=0;case 8:for(s+=1,i=void 0,o=Object.keys(a),u=0;u<o.length;u++)p=o[u],!a[p].visited&&(void 0===i||a[p].cost<a[i].cost)&&(i=p);if(void 0!==i){t.next=16;break}return console.error("Could not find path; sweeps are not connected."),t.abrupt("return");case 16:if(i!==n){t.next=18;break}return t.abrupt("break",23);case 18:for(a[i].visited=!0,h=Object.keys(r[i]),d=0;d<h.length;d++)l=h[d],f=a[i].distance+r[i][l],v=f+this.penalty(i,l)+this.heuristic(l,n),l in a?!a[l].visited&&a[l].cost>v&&(a[l].parent=i,a[l].distance=f,a[l].cost=v):a[l]={visited:!1,distance:f,cost:v,parent:i};t.next=8;break;case 23:for(console.log("Pathfind iterations: ".concat(s)),b=[w=n];null!==a[w].parent;)w=a[w].parent,b.push(w);return b.reverse(),t.abrupt("return",b);case 29:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()}]),t}(),x=function t(){var e=this;Object(h.a)(this,t),this.material=void 0,this.inputs={visible:!1,path:[],radius:.15,color:65280,opacity:.5,heightOffset:-1,stepMultiplier:5},this.context=void 0,this.outputs={curve:null},this.onInit=Object(u.a)(c.a.mark((function t(){var n,r,a,s,i,o,u,p,h,d,l,f,v,w;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.context.three,r=e.inputs,a=r.path,s=r.radius,i=r.heightOffset,o=r.opacity,u=r.color,p=r.stepMultiplier,!(a.length<2)&&a.every((function(t){return!!t}))){t.next=4;break}return t.abrupt("return");case 4:h=a.map((function(t){return new n.Vector3(t.x,t.y+i,t.z)})),d=new n.CatmullRomCurve3(h),l={steps:p*a.length,bevelEnabled:!1,extrudePath:d},f=(new n.Shape).absarc(0,0,s,0,2*Math.PI,!1),v=new n.ExtrudeGeometry(f,l),e.material=new n.MeshBasicMaterial({color:u,transparent:!0,opacity:o}),w=new n.Mesh(v,e.material),e.outputs.objectRoot=w,e.outputs.curve=d;case 13:case"end":return t.stop()}}),t)}))),this.onEvent=function(t,e){},this.onInputsUpdated=function(t){},this.onTick=function(t){},this.onDestroy=function(){var t;null===(t=e.material)||void 0===t||t.dispose()}},O="sdk-component.pathRenderer";function S(){return new x}var g=function t(){var e=this;Object(h.a)(this,t),this.startTime=void 0,this.length=void 0,this.up=void 0,this.inputs={curve:null,speed:1,verticalOffset:1},this.context=void 0,this.outputs={camera:null},this.onInit=Object(u.a)(c.a.mark((function t(){var n,r;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.context.three,console.log("start"),r=new n.PerspectiveCamera(45,1.333,1,1e3),e.outputs.camera=r,r.position.copy(e.inputs.curve.getPoint(0)),r.position.y+=e.inputs.verticalOffset,r.updateProjectionMatrix(),e.startTime=Date.now(),e.length=e.inputs.curve.getLength(),e.up=new n.Vector3(0,1,0);case 10:case"end":return t.stop()}}),t)}))),this.onEvent=function(t,e){},this.onInputsUpdated=function(t){},this.onTick=function(){var t=Object(u.a)(c.a.mark((function t(n){var r,a,s,i,o,u,p,h;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=e.context.three,a=(Date.now()-e.startTime)/1e3,s=e.inputs.speed*a/e.length,i=e.inputs.speed*(a+1)/e.length,o=e.inputs.curve.getPointAt(s),u=e.inputs.curve.getPointAt(i),e.outputs.camera.position.copy(o),e.outputs.camera.position.y+=1,p=(new r.Matrix4).lookAt(o,u,e.up),h=(new e.context.three.Quaternion).setFromRotationMatrix(p),e.outputs.camera.quaternion.copy(h),e.outputs.camera.updateProjectionMatrix();case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),this.onDestroy=function(){}},M="sdk-component.cameraController";function P(){return new g}var D=function(){var t=Object(u.a)(c.a.mark((function t(e){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([e.Scene.register(O,S),e.Scene.register(M,P)]);case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),I={m:"opSBz3SgMg3",applicationKey:"q44m20q8yk81yi0qgixrremda",title:"0",qs:"1",hr:"0",brand:"0",help:"0",play:"1"},N=function(t){Object(l.a)(n,t);var e=Object(f.a)(n);function n(t){var r;Object(h.a)(this,n),(r=e.call(this,t)).src=void 0,r.sdk=void 0,r.pathNode=void 0,r.path=void 0,r.pathfinder=void 0,r.flyNode=void 0,r.onOptionSelect=function(t){r.setState({selectedSweepId:t.currentTarget.value})};var a=r.handleUrlParams();return r.src="".concat("/sdk_pathfinder","/bundle/showcase.html?").concat(a),r.state={sweepData:[]},r}return Object(d.a)(n,[{key:"handleUrlParams",value:function(){for(var t=new URLSearchParams(window.location.search),e=0,n=Object.entries(I);e<n.length;e++){var r=Object(p.a)(n[e],2),a=r[0],s=r[1];t.has(a)||t.append(a,""+s)}return t.toString()}},{key:"componentDidMount",value:function(){var t=Object(u.a)(c.a.mark((function t(){var e,n=this;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v("showcase",I.applicationKey);case 2:return this.sdk=t.sent,t.next=5,D(this.sdk);case 5:return t.next=7,this.sdk.Model.getData();case 7:e=t.sent.sweeps,this.pathfinder=new k(e),this.setState({sweepData:e}),this.sdk.Sweep.data.subscribe({onCollectionUpdated:function(t){n.setState({sweepMap:t})}}),this.sdk.Sweep.current.subscribe((function(t){n.setState({currSweepId:t.sid})}));case 12:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){this.handlePath()}},{key:"handlePath",value:function(){var t=Object(u.a)(c.a.mark((function t(){var e,n,r,a,s,i,o;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.state,n=e.currSweepId,r=e.selectedSweepId,a=e.sweepMap,s=this.sdk,i=this.pathfinder,!(s&&a&&n&&r&&i)){t.next=14;break}return t.next=5,i.findShortestPath(n,r);case 5:if(o=t.sent){t.next=8;break}return t.abrupt("return");case 8:return this.pathNode&&this.pathNode.stop(),t.next=11,s.Scene.createNode();case 11:this.pathNode=t.sent,this.path=this.pathNode.addComponent(O,{path:o.map((function(t){return y(t,a)})),opacity:.7,radius:.12,stepMultiplier:10,color:9303907}),this.pathNode.start();case 14:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"startFly",value:function(){var t=Object(u.a)(c.a.mark((function t(){var e,n,r,a;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.sdk,n=this.path,!e||!n){t.next=15;break}return this.endFly(),t.next=5,e.Scene.createNode();case 5:return this.flyNode=t.sent,t.next=8,this.flyNode.addComponent(M);case 8:return r=t.sent,a=this.flyNode.addComponent("mp.camera",{enabled:!0}),r.bind("curve",n,"curve"),a.bind("camera",r,"camera"),t.next=14,e.Mode.moveTo(e.Mode.Mode.DOLLHOUSE,{transition:e.Mode.TransitionType.INSTANT});case 14:this.flyNode.start();case 15:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"endFly",value:function(){var t=Object(u.a)(c.a.mark((function t(){var e,n;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=this.sdk,n=this.flyNode,e&&n&&n.stop();case 2:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t=this,e=this.state,n=e.currSweepId,r=e.sweepData;return Object(w.jsxs)("div",{className:"app",children:[Object(w.jsx)(b,{src:this.src}),Object(w.jsx)(j,{currSweepId:n,sweepData:r,onChange:this.onOptionSelect}),Object(w.jsx)("button",{onClick:function(){return t.startFly()},children:"Start Fly"}),Object(w.jsx)("button",{onClick:function(){return t.endFly()},children:"End Fly"})]})}}]),n}(r.Component);i.a.render(Object(w.jsx)(a.a.StrictMode,{children:Object(w.jsx)(N,{})}),document.getElementById("root"))}},[[21,1,2]]]);
//# sourceMappingURL=main.5aa0d1ad.chunk.js.map