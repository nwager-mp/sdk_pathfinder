(this.webpackJsonpsdk_pathfinder=this.webpackJsonpsdk_pathfinder||[]).push([[0],{19:function(e,t,n){},21:function(e,t,n){},22:function(e,t,n){},24:function(e,t,n){},25:function(e,t,n){},26:function(e,t,n){},27:function(e,t,n){},28:function(e,t,n){},29:function(e,t,n){"use strict";n.r(t);var r=n(3),a=n.n(r),s=n(14),c=n.n(s),i=(n(19),n(10)),o=n(1),u=n.n(o),d=n(5),p=n(2),h=n(4),l=n(9),f=n(7),v=n(6),b=function(e,t){return new Promise((function(n,r){var a=setInterval(function(){var r=Object(d.a)(u.a.mark((function r(){var s,c,i;return u.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(s=null,!(s=e instanceof HTMLIFrameElement?e:document.getElementById(e))){r.next=7;break}return r.next=5,s.contentWindow;case 5:(c=r.sent.MP_SDK)&&(clearInterval(a),i=c.connect(s,t,"3.2"),n(i));case 7:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}(),100)}))},j=(n(21),n(22),n(0)),m=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(){return Object(p.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"render",value:function(){var e=this.props,t=e.src,n=e.id,r=e.customRef;return Object(j.jsx)("div",{className:"frame",children:Object(j.jsx)("iframe",{id:n||"showcase",className:"frame",src:t,title:"showcase",allowFullScreen:!0,frameBorder:"0",ref:r})})}}]),n}(r.Component),O=n(13),x=(n(24),n(25),function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(){return Object(p.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"render",value:function(){var e=this.props,t=e.header,n=e.children;return Object(j.jsxs)("div",{className:"accordion",children:[t&&Object(j.jsx)("div",{className:"accordion-header",children:t}),Object(j.jsx)("div",{className:"accordion-groups",children:n})]})}}]),n}(r.Component)),w=n(8),y=n.n(w),k=(n(26),n(27),"40px"),g=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(){return Object(p.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"render",value:function(){var e=this.props,t=e.header,n=e.body,r=e.selected,a=e.onClick;return Object(j.jsx)("div",{className:y()("accordion-item",{selected:!!r}),onClick:a,style:{height:k},children:Object(j.jsxs)("div",{className:"accordion-item-details",children:[Object(j.jsx)("div",{className:"accordion-item-header",children:t}),Object(j.jsx)("div",{className:"accordion-item-body",children:n})]})})}}]),n}(r.Component),S=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(e){var r;Object(p.a)(this,n),(r=t.call(this,e)).onClick=function(){var e=r.state,t=e.expanded,n=e.showChildren;r.setState({expanded:!t},(function(){return setTimeout((function(){return r.setState({showChildren:!n})}),n?250:0)}))};var a=r.props.expanded;return r.state={expanded:!!a,showChildren:!!a},r}return Object(h.a)(n,[{key:"render",value:function(){var e=this.props,t=e.children,n=e.header,r=this.state.expanded,a=0;t&&(a=Array.isArray(t)?t.length:1);var s=a>0,c=r&&s?"calc(".concat(a,"*").concat(k,")"):"0";return Object(j.jsxs)("div",{className:y()("accordion-group-container",{collapsed:!r}),children:[Object(j.jsxs)("div",{className:"accordion-group-header",onClick:this.onClick,children:[""+n+(s?" (".concat(a,")"):""),Object(j.jsx)("img",{src:"/sdk_pathfinder/icons/chevron-down.svg",className:"accordion-icon icon-chevron-down",alt:"Toggle accordion group"})]}),Object(j.jsx)("div",{className:y()("accordion-group",{collapsed:!r}),style:{height:c},children:a>0&&t})]})}}]),n}(r.Component),N=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(e){var r;return Object(p.a)(this,n),(r=t.call(this,e)).state={sweepGroups:{}},r}return Object(h.a)(n,[{key:"getGroups",value:function(){var e,t=this.props.sweepData,n={},r=Object(O.a)(t);try{for(r.s();!(e=r.n()).done;){var a=e.value,s=""+a.floor;s in n||(n[s]=[]),n[s].push(a)}}catch(c){r.e(c)}finally{r.f()}return n}},{key:"renderItem",value:function(e){var t=this.props,n=t.onChange,r=t.selectedSweepId,a=e.sid;return Object(j.jsx)(g,{header:a,onClick:function(){return n(a)},selected:a===r})}},{key:"renderGroups",value:function(){for(var e=this.props.selectedSweepId,t=this.getGroups(),n=[],r=void 0,a=0,s=Object.entries(t);a<s.length;a++){var c=Object(i.a)(s[a],2),o=c[0],u=c[1];o in n||(n[o]=[]);var d,p=[],h=Object(O.a)(u);try{for(h.s();!(d=h.n()).done;){var l=d.value;p.push(this.renderItem(l)),l.sid===e&&(r=l.floor)}}catch(f){h.e(f)}finally{h.f()}n.push(Object(j.jsx)(S,{header:"Floor ".concat(o),expanded:!!r&&""+r===o,children:p}))}return n}},{key:"render",value:function(){var e=this.props,t=e.sweepData,n=e.onClose;return Object(j.jsxs)("div",{className:"menu",children:[Object(j.jsxs)("div",{className:"menu-header",children:[Object(j.jsx)("div",{className:"menu-header-text",children:"Sweeps (".concat(t.length,")")}),n&&Object(j.jsx)("button",{type:"button",className:"menu-close-button",onClick:n,children:Object(j.jsx)("img",{src:"/sdk_pathfinder/icons/x-lg.svg",className:" icon-x-lg",alt:"Close"})})]}),Object(j.jsx)(x,{children:this.renderGroups()})]})}}]),n}(r.Component);function C(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)+Math.pow(e.z-t.z,2))}function M(e,t){return t[e].position}var I=function(){function e(t){var n=this;Object(p.a)(this,e),this.VERT_THRESHOLD=.5,this.HORZ_THRESHOLD=10,this.graph={},this.path=[],this.sweepPositions={},t.forEach((function(e){return n.sweepPositions[e.sid]=e.position})),this.createGraph(t)}return Object(h.a)(e,[{key:"createGraph",value:function(e){for(var t={},n=0;n<e.length;n++){for(var r=e[n],a={},s=r.neighbors,c=0;c<s.length;c++){var i=s[c],o=C(r.position,this.sweepPositions[i]);a[i]=o}t[r.sid]=a}this.graph=t}},{key:"heuristic",value:function(e,t){var n=this.sweepPositions;return C(n[e],n[t])}},{key:"penalty",value:function(e,t){var n=this.sweepPositions;return Math.pow((n[e].y-n[t].y)/this.VERT_THRESHOLD,4)+(Math.pow(n[e].x-n[t].x,2)+Math.pow(n[e].z-n[t].z,2))/this.HORZ_THRESHOLD}},{key:"findShortestPath",value:function(){var e=Object(d.a)(u.a.mark((function e(t,n){var r,a,s,c,i,o,d,p,h,l,f,v,b,j;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(r=this.graph)[t]&&void 0!==r[n]){e.next=4;break}return console.error("Sweep SID(s) is invalid."),e.abrupt("return");case 4:(a={})[t]={visited:!1,distance:0,cost:0,parent:null},s=0;case 7:for(s+=1,c=void 0,i=Object.keys(a),o=0;o<i.length;o++)d=i[o],!a[d].visited&&(void 0===c||a[d].cost<a[c].cost)&&(c=d);if(void 0!==c){e.next=15;break}return console.error("Could not find path; sweeps are not connected."),e.abrupt("return");case 15:if(c!==n){e.next=17;break}return e.abrupt("break",22);case 17:for(a[c].visited=!0,p=Object.keys(r[c]),h=0;h<p.length;h++)l=p[h],f=a[c].distance+r[c][l],v=f+this.penalty(c,l)+this.heuristic(l,n),l in a?!a[l].visited&&a[l].cost>v&&(a[l].parent=c,a[l].distance=f,a[l].cost=v):a[l]={visited:!1,distance:f,cost:v,parent:c};e.next=7;break;case 22:for(console.log("Pathfind iterations: ".concat(s)),j=[b=n];null!==a[b].parent;)b=a[b].parent,j.push(b);return j.reverse(),e.abrupt("return",j);case 28:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),P=function e(){var t=this;Object(p.a)(this,e),this.material=void 0,this.inputs={visible:!1,path:[],radius:.15,color:65280,opacity:.5,heightOffset:-1.1,stepMultiplier:5},this.context=void 0,this.outputs={curve:null,distance:0},this.onInit=Object(d.a)(u.a.mark((function e(){var n,r,a,s,c,i,o,d,p,h,l,f,v,b,j;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.context.three,r=t.inputs,a=r.path,s=r.radius,c=r.heightOffset,i=r.opacity,o=r.color,d=r.stepMultiplier,!(a.length<2)&&a.every((function(e){return!!e}))){e.next=4;break}return e.abrupt("return");case 4:p=0,h=a.map((function(e,t){return t>0&&(p+=C(a[t-1],e)),new n.Vector3(e.x,e.y+c,e.z)})),l=new n.CatmullRomCurve3(h),f={steps:d*a.length,bevelEnabled:!1,extrudePath:l},v=(new n.Shape).absarc(0,0,s,0,2*Math.PI,!1),b=new n.ExtrudeGeometry(v,f),t.material=new n.MeshBasicMaterial({color:o,transparent:!0,opacity:i}),j=new n.Mesh(b,t.material),t.outputs.objectRoot=j,t.outputs.curve=l,t.outputs.distance=p;case 15:case"end":return e.stop()}}),e)}))),this.onEvent=function(e,t){},this.onInputsUpdated=function(e){},this.onTick=function(e){},this.onDestroy=function(){var e;null===(e=t.material)||void 0===e||e.dispose()}},D="sdk-component.pathRenderer";function E(){return new P}var T=function e(){var t=this;Object(p.a)(this,e),this.startTime=void 0,this.length=void 0,this.up=void 0,this.inputs={curve:null,speed:1,verticalOffset:1},this.context=void 0,this.outputs={camera:null},this.onInit=Object(d.a)(u.a.mark((function e(){var n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.context.three,console.log("start"),r=new n.PerspectiveCamera(45,1.333,1,1e3),t.outputs.camera=r,r.position.copy(t.inputs.curve.getPoint(0)),r.position.y+=t.inputs.verticalOffset,r.updateProjectionMatrix(),t.startTime=Date.now(),t.length=t.inputs.curve.getLength(),t.up=new n.Vector3(0,1,0);case 10:case"end":return e.stop()}}),e)}))),this.onEvent=function(e,t){},this.onInputsUpdated=function(e){},this.onTick=function(){var e=Object(d.a)(u.a.mark((function e(n){var r,a,s,c,i,o,d,p;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.context.three,a=(Date.now()-t.startTime)/1e3,s=t.inputs.speed*a/t.length,c=t.inputs.speed*(a+1)/t.length,i=t.inputs.curve.getPointAt(s),o=t.inputs.curve.getPointAt(c),t.outputs.camera.position.copy(i),t.outputs.camera.position.y+=1,d=(new r.Matrix4).lookAt(i,o,t.up),p=(new t.context.three.Quaternion).setFromRotationMatrix(d),t.outputs.camera.quaternion.copy(p),t.outputs.camera.updateProjectionMatrix();case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onDestroy=function(){}},R="sdk-component.cameraController";function H(){return new T}var F=function(){var e=Object(d.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([t.Scene.register(D,E),t.Scene.register(R,H)]);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),_=(n(28),function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(){return Object(p.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"render",value:function(){var e=this.props,t=e.text,n=e.onClick;return Object(j.jsx)("div",{className:"menu-button-container",children:Object(j.jsx)("button",{type:"button",className:y()("menu-button",{"text-button":!!t}),onClick:n,children:t||Object(j.jsx)("img",{src:"/sdk_pathfinder/icons/chevron-down.svg",className:"icon-chevron-down",alt:"Open Menu"})})})}}]),n}(r.Component)),L={m:"opSBz3SgMg3",applicationKey:"q44m20q8yk81yi0qgixrremda",title:"0",qs:"1",hr:"0",brand:"0",help:"0",play:"1"},G=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(e){var r;Object(p.a)(this,n),(r=t.call(this,e)).src=void 0,r.sdk=void 0,r.frameRef=a.a.createRef(),r.pathNode=void 0,r.path=void 0,r.pathfinder=void 0,r.flyNode=void 0,r.onOptionSelect=function(e){r.setState({selectedSweepId:e})},r.startFly=Object(d.a)(u.a.mark((function e(){var t,n,a,s,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Object(l.a)(r),n=t.sdk,a=t.path,!n||!a){e.next=15;break}return r.endFly(),e.next=5,n.Scene.createNode();case 5:return r.flyNode=e.sent,e.next=8,r.flyNode.addComponent(R);case 8:return s=e.sent,c=r.flyNode.addComponent("mp.camera",{enabled:!0}),s.bind("curve",a,"curve"),c.bind("camera",s,"camera"),e.next=14,n.Mode.moveTo(n.Mode.Mode.DOLLHOUSE,{transition:n.Mode.TransitionType.INSTANT});case 14:r.flyNode.start();case 15:case"end":return e.stop()}}),e)}))),r.endFly=Object(d.a)(u.a.mark((function e(){var t,n,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(l.a)(r),n=t.sdk,a=t.flyNode,n&&a&&a.stop();case 2:case"end":return e.stop()}}),e)}))),r.toggleMenu=function(){r.setState({menuEnabled:!r.state.menuEnabled})};var s=r.handleUrlParams();return r.src="".concat("/sdk_pathfinder","/bundle/showcase.html?").concat(s),r.state={sweepData:[],menuEnabled:!0},r}return Object(h.a)(n,[{key:"handleUrlParams",value:function(){for(var e=new URLSearchParams(window.location.search),t=0,n=Object.entries(L);t<n.length;t++){var r=Object(i.a)(n[t],2),a=r[0],s=r[1];e.has(a)||e.append(a,""+s)}return e.toString()}},{key:"componentDidMount",value:function(){var e=Object(d.a)(u.a.mark((function e(){var t,n=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b("showcase",L.applicationKey);case 2:return this.sdk=e.sent,e.next=5,F(this.sdk);case 5:return e.next=7,this.sdk.Model.getData();case 7:t=e.sent.sweeps,this.pathfinder=new I(t),this.setState({sweepData:t}),this.sdk.Sweep.data.subscribe({onCollectionUpdated:function(e){n.setState({sweepMap:e})}}),this.sdk.Sweep.current.subscribe((function(e){n.setState({currSweepId:e.sid})}));case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){this.handlePath()}},{key:"handlePath",value:function(){var e=Object(d.a)(u.a.mark((function e(){var t,n,r,a,s,c,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.state,n=t.currSweepId,r=t.selectedSweepId,a=t.sweepMap,s=this.sdk,c=this.pathfinder,!(s&&a&&n&&r&&c)){e.next=14;break}return e.next=5,c.findShortestPath(n,r);case 5:if(i=e.sent){e.next=8;break}return e.abrupt("return");case 8:return this.pathNode&&this.pathNode.stop(),e.next=11,s.Scene.createNode();case 11:this.pathNode=e.sent,this.path=this.pathNode.addComponent(D,{path:i.map((function(e){return M(e,a)})),opacity:.7,radius:.12,stepMultiplier:10,color:9303907}),this.pathNode.start();case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.currSweepId,n=e.selectedSweepId,r=e.sweepData,a=e.menuEnabled;return Object(j.jsxs)("div",{className:"app",children:[Object(j.jsx)(m,{src:this.src,customRef:this.frameRef}),Object(j.jsxs)("div",{className:"fly-buttons",children:[Object(j.jsx)("button",{onClick:this.startFly,children:"Start Fly"}),Object(j.jsx)("button",{onClick:this.endFly,children:"End Fly"})]}),!a&&Object(j.jsx)(_,{onClick:this.toggleMenu}),a&&Object(j.jsx)(N,{currSweepId:t,selectedSweepId:n,sweepData:r,onChange:this.onOptionSelect,onClose:this.toggleMenu})]})}}]),n}(r.Component);c.a.render(Object(j.jsx)(a.a.StrictMode,{children:Object(j.jsx)(G,{})}),document.getElementById("root"))}},[[29,1,2]]]);
//# sourceMappingURL=main.e65939f6.chunk.js.map