(this.webpackJsonpsdk_pathfinder=this.webpackJsonpsdk_pathfinder||[]).push([[0],{18:function(t,e,n){},20:function(t,e,n){},21:function(t,e,n){},23:function(t,e,n){},24:function(t,e,n){},25:function(t,e,n){},26:function(t,e,n){},27:function(t,e,n){"use strict";n.r(e);var r=n(4),a=n.n(r),i=n(10),s=n.n(i),o=(n(18),n(1)),c=n.n(o),u=n(3),p=n(13),h=n(2),d=n(5),l=n(7),f=n(6),v=function(t,e){return new Promise((function(n,r){var a=setInterval(function(){var r=Object(u.a)(c.a.mark((function r(){var i,s,o;return c.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=null,!(i=t instanceof HTMLIFrameElement?t:document.getElementById(t))){r.next=7;break}return r.next=5,i.contentWindow;case 5:(s=r.sent.MP_SDK)&&(clearInterval(a),o=s.connect(i,e,"3.2"),n(o));case 7:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}(),100)}))},b=(n(20),n(21),n(0)),m=function(t){Object(l.a)(n,t);var e=Object(f.a)(n);function n(){return Object(h.a)(this,n),e.apply(this,arguments)}return Object(d.a)(n,[{key:"render",value:function(){return Object(b.jsx)("div",{className:"frame",children:Object(b.jsx)("iframe",{id:this.props.id||"showcase",className:"frame",src:this.props.src,title:"showcase",allowFullScreen:!0,frameBorder:"0"})})}}]),n}(r.Component),j=n(11),w=(n(23),n(24),function(t){Object(l.a)(n,t);var e=Object(f.a)(n);function n(){return Object(h.a)(this,n),e.apply(this,arguments)}return Object(d.a)(n,[{key:"render",value:function(){var t=this.props,e=t.header,n=t.children;return Object(b.jsxs)("div",{className:"accordion",children:[e&&Object(b.jsx)("div",{className:"accordion-header",children:e}),n]})}}]),n}(r.Component)),y=n(12),O=n.n(y),x=(n(25),n(26),"40px"),k=function(t){Object(l.a)(n,t);var e=Object(f.a)(n);function n(){return Object(h.a)(this,n),e.apply(this,arguments)}return Object(d.a)(n,[{key:"render",value:function(){var t=this.props,e=t.header,n=t.body,r=t.onClick;return Object(b.jsx)("div",{className:"accordion-item",onClick:r,style:{height:x},children:Object(b.jsxs)("div",{className:"accordion-item-details",children:[Object(b.jsx)("div",{className:"accordion-item-header",children:e}),Object(b.jsx)("div",{className:"accordion-item-body",children:n})]})})}}]),n}(r.Component),g=function(t){Object(l.a)(n,t);var e=Object(f.a)(n);function n(t){var r;Object(h.a)(this,n),(r=e.call(this,t)).onClick=function(){var t=r.state,e=t.expanded,n=t.showChildren;r.setState({expanded:!e},(function(){return setTimeout((function(){return r.setState({showChildren:!n})}),n?250:0)}))};var a=r.props.expanded;return r.state={expanded:!!a,showChildren:!!a},r}return Object(d.a)(n,[{key:"render",value:function(){var t=this.props,e=t.children,n=t.header,r=this.state.expanded,a=0;e&&(a=Array.isArray(e)?e.length:1);var i=a>0,s=r&&i?"calc(".concat(a,"*").concat(x,")"):"0";return Object(b.jsxs)("div",{className:"accordion-group-container",children:[Object(b.jsx)("div",{className:"accordion-group-header",onClick:this.onClick,children:""+n+(i?" (".concat(a,")"):"")}),Object(b.jsx)("div",{className:O()("accordion-group",{expanded:r}),style:{height:s},children:a>0&&e})]})}}]),n}(r.Component);function S(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)+Math.pow(t.z-e.z,2))}function M(t,e){return e[t].position}var N=function(t){Object(l.a)(n,t);var e=Object(f.a)(n);function n(t){var r;return Object(h.a)(this,n),(r=e.call(this,t)).sweeps={},r.state={options:[]},r}return Object(d.a)(n,[{key:"componentDidUpdate",value:function(t){var e=this;t!==this.props&&(this.props.sweepData.map((function(t){return e.sweeps[t.sid]=t})),this.getOptions().then((function(t){e.setState({options:t})})))}},{key:"getOptions",value:function(){var t=Object(u.a)(c.a.mark((function t(){var e,n,r,a,i,s,o,u;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(e=this.props.currSweepId,n=this.sweeps,r=[],a=0,i=Object.keys(n);a<i.length;a++)s=i[a],o=void 0,e&&(u=n[s].position,o=S(n[e].position,u)),r.push({id:s,distance:o});return t.abrupt("return",r);case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"renderItem",value:function(t){var e=this.props.onChange;return Object(b.jsx)(k,{header:t.id,body:t.distance?Math.round(t.distance)+"m":void 0,onClick:function(){return e(t.id)}})}},{key:"renderGroups",value:function(){var t,e=this.state.options,n=[],r=Object(j.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push(this.renderItem(a))}}catch(i){r.e(i)}finally{r.f()}return Object(b.jsx)(g,{header:"All Sweeps",expanded:!0,children:n})}},{key:"render",value:function(){var t=this.state.options;return Object(b.jsx)("div",{className:"menu",children:Object(b.jsx)(w,{header:"Sweeps (".concat(t.length,")"),children:this.renderGroups()})})}}]),n}(r.Component),C=function(){function t(e){var n=this;Object(h.a)(this,t),this.VERT_THRESHOLD=.5,this.HORZ_THRESHOLD=10,this.graph={},this.path=[],this.sweepPositions={},e.map((function(t){return n.sweepPositions[t.sid]=t.position})),this.createGraph(e)}return Object(d.a)(t,[{key:"createGraph",value:function(t){for(var e={},n=0;n<t.length;n++){for(var r=t[n],a={},i=r.neighbors,s=0;s<i.length;s++){var o=i[s],c=S(r.position,this.sweepPositions[o]);a[o]=c}e[r.sid]=a}this.graph=e}},{key:"heuristic",value:function(t,e){var n=this.sweepPositions;return S(n[t],n[e])}},{key:"penalty",value:function(t,e){var n=this.sweepPositions;return Math.pow((n[t].y-n[e].y)/this.VERT_THRESHOLD,4)+(Math.pow(n[t].x-n[e].x,2)+Math.pow(n[t].z-n[e].z,2))/this.HORZ_THRESHOLD}},{key:"findShortestPath",value:function(){var t=Object(u.a)(c.a.mark((function t(e,n){var r,a,i,s,o,u,p,h,d,l,f,v,b,m;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this.graph,console.log(e,n),void 0!==r[e]&&void 0!==r[n]){t.next=5;break}return console.error("Sweep SID(s) is invalid."),t.abrupt("return");case 5:(a={})[e]={visited:!1,distance:0,cost:0,parent:null},i=0;case 8:for(i+=1,s=void 0,o=Object.keys(a),u=0;u<o.length;u++)p=o[u],!a[p].visited&&(void 0===s||a[p].cost<a[s].cost)&&(s=p);if(void 0!==s){t.next=16;break}return console.error("Could not find path; sweeps are not connected."),t.abrupt("return");case 16:if(s!==n){t.next=18;break}return t.abrupt("break",23);case 18:for(a[s].visited=!0,h=Object.keys(r[s]),d=0;d<h.length;d++)l=h[d],f=a[s].distance+r[s][l],v=f+this.penalty(s,l)+this.heuristic(l,n),l in a?!a[l].visited&&a[l].cost>v&&(a[l].parent=s,a[l].distance=f,a[l].cost=v):a[l]={visited:!1,distance:f,cost:v,parent:s};t.next=8;break;case 23:for(console.log("Pathfind iterations: ".concat(i)),m=[b=n];null!==a[b].parent;)b=a[b].parent,m.push(b);return m.reverse(),t.abrupt("return",m);case 29:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()}]),t}(),P=function t(){var e=this;Object(h.a)(this,t),this.material=void 0,this.inputs={visible:!1,path:[],radius:.15,color:65280,opacity:.5,heightOffset:-1,stepMultiplier:5},this.context=void 0,this.outputs={curve:null},this.onInit=Object(u.a)(c.a.mark((function t(){var n,r,a,i,s,o,u,p,h,d,l,f,v,b;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.context.three,r=e.inputs,a=r.path,i=r.radius,s=r.heightOffset,o=r.opacity,u=r.color,p=r.stepMultiplier,!(a.length<2)&&a.every((function(t){return!!t}))){t.next=4;break}return t.abrupt("return");case 4:h=a.map((function(t){return new n.Vector3(t.x,t.y+s,t.z)})),d=new n.CatmullRomCurve3(h),l={steps:p*a.length,bevelEnabled:!1,extrudePath:d},f=(new n.Shape).absarc(0,0,i,0,2*Math.PI,!1),v=new n.ExtrudeGeometry(f,l),e.material=new n.MeshBasicMaterial({color:u,transparent:!0,opacity:o}),b=new n.Mesh(v,e.material),e.outputs.objectRoot=b,e.outputs.curve=d;case 13:case"end":return t.stop()}}),t)}))),this.onEvent=function(t,e){},this.onInputsUpdated=function(t){},this.onTick=function(t){},this.onDestroy=function(){var t;null===(t=e.material)||void 0===t||t.dispose()}},I="sdk-component.pathRenderer";function D(){return new P}var T=function t(){var e=this;Object(h.a)(this,t),this.startTime=void 0,this.length=void 0,this.up=void 0,this.inputs={curve:null,speed:1,verticalOffset:1},this.context=void 0,this.outputs={camera:null},this.onInit=Object(u.a)(c.a.mark((function t(){var n,r;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.context.three,console.log("start"),r=new n.PerspectiveCamera(45,1.333,1,1e3),e.outputs.camera=r,r.position.copy(e.inputs.curve.getPoint(0)),r.position.y+=e.inputs.verticalOffset,r.updateProjectionMatrix(),e.startTime=Date.now(),e.length=e.inputs.curve.getLength(),e.up=new n.Vector3(0,1,0);case 10:case"end":return t.stop()}}),t)}))),this.onEvent=function(t,e){},this.onInputsUpdated=function(t){},this.onTick=function(){var t=Object(u.a)(c.a.mark((function t(n){var r,a,i,s,o,u,p,h;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=e.context.three,a=(Date.now()-e.startTime)/1e3,i=e.inputs.speed*a/e.length,s=e.inputs.speed*(a+1)/e.length,o=e.inputs.curve.getPointAt(i),u=e.inputs.curve.getPointAt(s),e.outputs.camera.position.copy(o),e.outputs.camera.position.y+=1,p=(new r.Matrix4).lookAt(o,u,e.up),h=(new e.context.three.Quaternion).setFromRotationMatrix(p),e.outputs.camera.quaternion.copy(h),e.outputs.camera.updateProjectionMatrix();case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),this.onDestroy=function(){}},E="sdk-component.cameraController";function R(){return new T}var H=function(){var t=Object(u.a)(c.a.mark((function t(e){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([e.Scene.register(I,D),e.Scene.register(E,R)]);case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),F={m:"opSBz3SgMg3",applicationKey:"q44m20q8yk81yi0qgixrremda",title:"0",qs:"1",hr:"0",brand:"0",help:"0",play:"1"},L=function(t){Object(l.a)(n,t);var e=Object(f.a)(n);function n(t){var r;Object(h.a)(this,n),(r=e.call(this,t)).src=void 0,r.sdk=void 0,r.pathNode=void 0,r.path=void 0,r.pathfinder=void 0,r.flyNode=void 0,r.onOptionSelect=function(t){r.setState({selectedSweepId:t})};var a=r.handleUrlParams();return r.src="".concat("/sdk_pathfinder","/bundle/showcase.html?").concat(a),r.state={sweepData:[]},r}return Object(d.a)(n,[{key:"handleUrlParams",value:function(){for(var t=new URLSearchParams(window.location.search),e=0,n=Object.entries(F);e<n.length;e++){var r=Object(p.a)(n[e],2),a=r[0],i=r[1];t.has(a)||t.append(a,""+i)}return t.toString()}},{key:"componentDidMount",value:function(){var t=Object(u.a)(c.a.mark((function t(){var e,n=this;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v("showcase",F.applicationKey);case 2:return this.sdk=t.sent,t.next=5,H(this.sdk);case 5:return t.next=7,this.sdk.Model.getData();case 7:e=t.sent.sweeps,this.pathfinder=new C(e),this.setState({sweepData:e}),this.sdk.Sweep.data.subscribe({onCollectionUpdated:function(t){n.setState({sweepMap:t})}}),this.sdk.Sweep.current.subscribe((function(t){n.setState({currSweepId:t.sid})}));case 12:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){this.handlePath(),console.log("updated")}},{key:"handlePath",value:function(){var t=Object(u.a)(c.a.mark((function t(){var e,n,r,a,i,s,o;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.state,n=e.currSweepId,r=e.selectedSweepId,a=e.sweepMap,i=this.sdk,s=this.pathfinder,!(i&&a&&n&&r&&s)){t.next=14;break}return t.next=5,s.findShortestPath(n,r);case 5:if(o=t.sent){t.next=8;break}return t.abrupt("return");case 8:return this.pathNode&&this.pathNode.stop(),t.next=11,i.Scene.createNode();case 11:this.pathNode=t.sent,this.path=this.pathNode.addComponent(I,{path:o.map((function(t){return M(t,a)})),opacity:.7,radius:.12,stepMultiplier:10,color:9303907}),this.pathNode.start();case 14:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"startFly",value:function(){var t=Object(u.a)(c.a.mark((function t(){var e,n,r,a;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.sdk,n=this.path,!e||!n){t.next=15;break}return this.endFly(),t.next=5,e.Scene.createNode();case 5:return this.flyNode=t.sent,t.next=8,this.flyNode.addComponent(E);case 8:return r=t.sent,a=this.flyNode.addComponent("mp.camera",{enabled:!0}),r.bind("curve",n,"curve"),a.bind("camera",r,"camera"),t.next=14,e.Mode.moveTo(e.Mode.Mode.DOLLHOUSE,{transition:e.Mode.TransitionType.INSTANT});case 14:this.flyNode.start();case 15:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"endFly",value:function(){var t=Object(u.a)(c.a.mark((function t(){var e,n;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=this.sdk,n=this.flyNode,e&&n&&n.stop();case 2:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t=this,e=this.state,n=e.currSweepId,r=e.sweepData;return Object(b.jsxs)("div",{className:"app",children:[Object(b.jsx)(m,{src:this.src}),Object(b.jsxs)("div",{className:"fly-buttons",children:[Object(b.jsx)("button",{onClick:function(){return t.startFly()},children:"Start Fly"}),Object(b.jsx)("button",{onClick:function(){return t.endFly()},children:"End Fly"})]}),Object(b.jsx)(N,{currSweepId:n,sweepData:r,onChange:this.onOptionSelect})]})}}]),n}(r.Component);s.a.render(Object(b.jsx)(a.a.StrictMode,{children:Object(b.jsx)(L,{})}),document.getElementById("root"))}},[[27,1,2]]]);
//# sourceMappingURL=main.57c7fcf3.chunk.js.map