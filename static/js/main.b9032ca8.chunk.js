(this.webpackJsonpsdk_pathfinder=this.webpackJsonpsdk_pathfinder||[]).push([[0],{14:function(t,e,n){},16:function(t,e,n){},17:function(t,e,n){},19:function(t,e,n){"use strict";n.r(e);var r=n(3),a=n.n(r),s=n(9),i=n.n(s),o=(n(14),n(0)),c=n.n(o),u=n(2),p=n(4),h=n(5),d=n(7),l=n(6),f=function(t,e){return new Promise((function(n,r){var a=setInterval(function(){var r=Object(u.a)(c.a.mark((function r(){var s,i,o;return c.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(s=null,!(s=t instanceof HTMLIFrameElement?t:document.getElementById(t))){r.next=7;break}return r.next=5,s.contentWindow;case 5:(i=r.sent.MP_SDK)&&(clearInterval(a),o=i.connect(s,e,"3.2"),n(o));case 7:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}(),100)}))},v=(n(16),n(17),n(1)),w=function(t){Object(d.a)(n,t);var e=Object(l.a)(n);function n(){return Object(p.a)(this,n),e.apply(this,arguments)}return Object(h.a)(n,[{key:"render",value:function(){return Object(v.jsx)("div",{className:"frame",children:Object(v.jsx)("iframe",{id:this.props.id||"showcase",className:"frame",src:this.props.src,title:"showcase",allowFullScreen:!0,frameBorder:"0"})})}}]),n}(r.Component);function b(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)+Math.pow(t.z-e.z,2))}function m(t,e){return e[t].position}var j=function(t){Object(d.a)(n,t);var e=Object(l.a)(n);function n(t){var r;return Object(p.a)(this,n),(r=e.call(this,t)).sweeps={},r.state={optionsElements:[]},r}return Object(h.a)(n,[{key:"componentDidUpdate",value:function(t){var e=this;t!==this.props&&(this.props.sweepData.map((function(t){return e.sweeps[t.sid]=t})),this.renderOptions().then((function(t){e.setState({optionsElements:t})})))}},{key:"renderOptions",value:function(){var t=Object(u.a)(c.a.mark((function t(){var e,n,r,a,s,i,o,u;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(e=this.props.currSweepId,n=this.sweeps,r=[],a=0,s=Object.keys(n);a<s.length;a++)i=s[a],o=void 0,e&&(u=n[i].position,o=b(n[e].position,u)),r.push({id:i,distance:o});return t.abrupt("return",r.map((function(t){return Object(v.jsx)("option",{value:t.id,children:t.id+(t.distance?" (".concat(Math.round(t.distance),"m)"):"")},t.id)})));case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t=this.props,e=t.selectedSweepId,n=t.onChange,r=this.state.optionsElements;return Object(v.jsx)("div",{className:"menu",children:Object(v.jsxs)("select",{onChange:n,value:e,children:[Object(v.jsx)("option",{value:"",children:"--"}),r]})})}}]),n}(r.Component),O=function(){function t(e){var n=this;Object(p.a)(this,t),this.VERT_THRESHOLD=1,this.HORZ_THRESHOLD=10,this.adjList={},this.path=[],this.sweepPositions={},e.map((function(t){return n.sweepPositions[t.sid]=t.position})),this.createGraph(e)}return Object(h.a)(t,[{key:"createGraph",value:function(t){for(var e={},n=0;n<t.length;n++){var r=t[n];e[r.sid]={};for(var a=r.neighbors,s=0;s<a.length;s++){var i=a[s],o=b(r.position,this.sweepPositions[i]);e[r.sid][i]=o}}this.adjList=e}},{key:"heuristic",value:function(t,e){var n=this.sweepPositions;return b(n[t],n[e])}},{key:"penalty",value:function(t,e){var n=this.sweepPositions;return Math.pow((n[t].y-n[e].y)/this.VERT_THRESHOLD,4)+Math.pow((Math.pow(n[t].x-n[e].x,2)+Math.pow(n[t].z-n[e].z,2))/this.HORZ_THRESHOLD,2)}},{key:"findShortestPath",value:function(){var t=Object(u.a)(c.a.mark((function t(e,n){var r,a,s,i,o,u,p,h,d,l,f,v,w,b;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this.adjList,console.log(e,n),void 0!==r[e]&&void 0!==r[n]){t.next=5;break}return console.error("Sweep SID(s) is invalid."),t.abrupt("return");case 5:(a={})[e]={visited:!1,distance:0,cost:0,parent:null},s=0;case 8:for(s+=1,i=void 0,o=Object.keys(a),u=0;u<o.length;u++)p=o[u],!a[p].visited&&(void 0===i||a[p].cost<a[i].cost)&&(i=p);if(void 0!==i){t.next=16;break}return console.error("Could not find path; sweeps are not connected."),t.abrupt("return");case 16:if(i!==n){t.next=18;break}return t.abrupt("break",23);case 18:for(a[i].visited=!0,h=Object.keys(r[i]),d=0;d<h.length;d++)l=h[d],f=a[i].distance+r[i][l],v=f+this.penalty(i,l)+this.heuristic(l,n),l in a?!a[l].visited&&a[l].cost>v&&(a[l].parent=i,a[l].distance=f,a[l].cost=v):a[l]={visited:!1,distance:f,cost:v,parent:i};t.next=8;break;case 23:for(b=[w=n];null!==a[w].parent;)w=a[w].parent,b.push(w);return console.log("Pathfind iterations: %d",s),t.abrupt("return",b);case 28:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()}]),t}(),k=function t(){var e=this;Object(p.a)(this,t),this.material=void 0,this.inputs={visible:!1,path:[],radius:.15,color:65280,opacity:.5,heightOffset:-1,stepMultiplier:5},this.context=void 0,this.outputs=void 0,this.onInit=Object(u.a)(c.a.mark((function t(){var n,r,a,s,i,o,u,p,h,d,l,f,v,w;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.context.three,r=e.inputs,a=r.path,s=r.radius,i=r.heightOffset,o=r.opacity,u=r.color,p=r.stepMultiplier,!(a.length<2)&&a.every((function(t){return!!t}))){t.next=4;break}return t.abrupt("return");case 4:h=a.map((function(t){return new n.Vector3(t.x,t.y+i,t.z)})),d=new n.CatmullRomCurve3(h),l={steps:p*a.length,bevelEnabled:!1,extrudePath:d},f=(new n.Shape).absarc(0,0,s,0,2*Math.PI,!1),v=new n.ExtrudeGeometry(f,l),e.material=new n.MeshBasicMaterial({color:u,transparent:!0,opacity:o}),w=new n.Mesh(v,e.material),e.outputs.objectRoot=w;case 12:case"end":return t.stop()}}),t)}))),this.onEvent=function(t,e){},this.onInputsUpdated=function(t){},this.onTick=function(t){},this.onDestroy=function(){var t;null===(t=e.material)||void 0===t||t.dispose()}},y="sdk-component.pathRenderer";function x(){return new k}var S=function(){var t=Object(u.a)(c.a.mark((function t(e){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([e.Scene.register(y,x)]);case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),M=function(t){Object(d.a)(n,t);var e=Object(l.a)(n);function n(t){var r;Object(p.a)(this,n),(r=e.call(this,t)).apiKey="e0iyprwgd7e7mckrhei7bwzza",r.modelId="opSBz3SgMg3",r.src=void 0,r.sdk=void 0,r.pathNode=void 0,r.pathfinder=void 0,r.onOptionSelect=function(t){r.setState({selectedSweepId:t.currentTarget.value})};var a="m=".concat(r.modelId,"&applicationKey=").concat(r.apiKey);return a+="&title=0&qs=1&hr=0&brand=0&help=0&play=1",r.src="".concat("/sdk_pathfinder","/bundle/showcase.html?").concat(a),r.state={sweepData:[]},r}return Object(h.a)(n,[{key:"componentDidMount",value:function(){var t=Object(u.a)(c.a.mark((function t(){var e,n=this;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,f("showcase",this.apiKey);case 2:return this.sdk=t.sent,t.next=5,S(this.sdk);case 5:return this.sdk.Sweep.data.subscribe({onCollectionUpdated:function(t){n.setState({sweepMap:t})}}),t.next=8,this.sdk.Model.getData();case 8:e=t.sent.sweeps,this.pathfinder=new O(e),this.setState({sweepData:e}),this.sdk.Sweep.current.subscribe((function(t){n.setState({currSweepId:t.sid})}));case 12:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){this.handlePath()}},{key:"handlePath",value:function(){var t=Object(u.a)(c.a.mark((function t(){var e,n,r,a,s,i,o;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.state,n=e.currSweepId,r=e.selectedSweepId,a=e.sweepMap,s=this.sdk,i=this.pathfinder,!(s&&a&&n&&r&&i)){t.next=14;break}return t.next=5,i.findShortestPath(n,r);case 5:if(o=t.sent){t.next=8;break}return t.abrupt("return");case 8:return this.pathNode&&this.pathNode.stop(),t.next=11,s.Scene.createNode();case 11:this.pathNode=t.sent,this.pathNode.addComponent(y,{path:o.map((function(t){return m(t,a)})),opacity:.7,radius:.12,stepMultiplier:10,color:9303907}),this.pathNode.start();case 14:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t=this.state,e=t.currSweepId,n=t.sweepData;return Object(v.jsxs)("div",{className:"app",children:[Object(v.jsx)(w,{src:this.src}),Object(v.jsx)(j,{currSweepId:e,sweepData:n,onChange:this.onOptionSelect})]})}}]),n}(r.Component);i.a.render(Object(v.jsx)(a.a.StrictMode,{children:Object(v.jsx)(M,{})}),document.getElementById("root"))}},[[19,1,2]]]);
//# sourceMappingURL=main.b9032ca8.chunk.js.map