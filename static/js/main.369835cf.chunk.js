(this.webpackJsonpsdk_pathfinder=this.webpackJsonpsdk_pathfinder||[]).push([[0],{18:function(e,t,n){},20:function(e,t,n){},21:function(e,t,n){},23:function(e,t,n){},24:function(e,t,n){},25:function(e,t,n){},26:function(e,t,n){},27:function(e,t,n){"use strict";n.r(t);var r=n(3),a=n.n(r),s=n(13),i=n.n(s),c=(n(18),n(1)),o=n.n(c),u=n(4),p=n(9),h=n(2),d=n(5),l=n(7),f=n(6),v=function(e,t){return new Promise((function(n,r){var a=setInterval(function(){var r=Object(u.a)(o.a.mark((function r(){var s,i,c;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(s=null,!(s=e instanceof HTMLIFrameElement?e:document.getElementById(e))){r.next=7;break}return r.next=5,s.contentWindow;case 5:(i=r.sent.MP_SDK)&&(clearInterval(a),c=i.connect(s,t,"3.2"),n(c));case 7:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}(),100)}))},b=(n(20),n(21),n(0)),j=function(e){Object(l.a)(n,e);var t=Object(f.a)(n);function n(){return Object(h.a)(this,n),t.apply(this,arguments)}return Object(d.a)(n,[{key:"render",value:function(){return Object(b.jsx)("div",{className:"frame",children:Object(b.jsx)("iframe",{id:this.props.id||"showcase",className:"frame",src:this.props.src,title:"showcase",allowFullScreen:!0,frameBorder:"0"})})}}]),n}(r.Component),m=n(12),w=(n(23),n(24),function(e){Object(l.a)(n,e);var t=Object(f.a)(n);function n(){return Object(h.a)(this,n),t.apply(this,arguments)}return Object(d.a)(n,[{key:"render",value:function(){var e=this.props,t=e.header,n=e.children;return Object(b.jsxs)("div",{className:"accordion",children:[t&&Object(b.jsx)("div",{className:"accordion-header",children:t}),Object(b.jsx)("div",{className:"accordion-groups",children:n})]})}}]),n}(r.Component)),y=n(8),O=n.n(y),x=(n(25),n(26),"40px"),k=function(e){Object(l.a)(n,e);var t=Object(f.a)(n);function n(){return Object(h.a)(this,n),t.apply(this,arguments)}return Object(d.a)(n,[{key:"render",value:function(){var e=this.props,t=e.header,n=e.body,r=e.selected,a=e.onClick;return Object(b.jsx)("div",{className:O()("accordion-item",{selected:!!r}),onClick:a,style:{height:x},children:Object(b.jsxs)("div",{className:"accordion-item-details",children:[Object(b.jsx)("div",{className:"accordion-item-header",children:t}),Object(b.jsx)("div",{className:"accordion-item-body",children:n})]})})}}]),n}(r.Component),g=function(e){Object(l.a)(n,e);var t=Object(f.a)(n);function n(e){var r;Object(h.a)(this,n),(r=t.call(this,e)).onClick=function(){var e=r.state,t=e.expanded,n=e.showChildren;r.setState({expanded:!t},(function(){return setTimeout((function(){return r.setState({showChildren:!n})}),n?250:0)}))};var a=r.props.expanded;return r.state={expanded:!!a,showChildren:!!a},r}return Object(d.a)(n,[{key:"render",value:function(){var e=this.props,t=e.children,n=e.header,r=this.state.expanded,a=0;t&&(a=Array.isArray(t)?t.length:1);var s=a>0,i=r&&s?"calc(".concat(a,"*").concat(x,")"):"0";return Object(b.jsxs)("div",{className:"accordion-group-container",children:[Object(b.jsx)("div",{className:"accordion-group-header",onClick:this.onClick,children:""+n+(s?" (".concat(a,")"):"")}),Object(b.jsx)("div",{className:O()("accordion-group",{expanded:r}),style:{height:i},children:a>0&&t})]})}}]),n}(r.Component),S=function(e){Object(l.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).state={sweepGroups:{}},r}return Object(d.a)(n,[{key:"getGroups",value:function(){var e,t=this.props.sweepData,n={},r=Object(m.a)(t);try{for(r.s();!(e=r.n()).done;){var a=e.value,s=""+a.floor;s in n||(n[s]=[]),n[s].push(a)}}catch(i){r.e(i)}finally{r.f()}return n}},{key:"renderItem",value:function(e){var t=this.props,n=t.onChange,r=t.selectedSweepId,a=e.sid;return Object(b.jsx)(k,{header:a,onClick:function(){return n(a)},selected:a===r})}},{key:"renderGroups",value:function(){for(var e=this.getGroups(),t=[],n=0,r=Object.entries(e);n<r.length;n++){var a=Object(p.a)(r[n],2),s=a[0],i=a[1];s in t||(t[s]=[]);var c,o=[],u=Object(m.a)(i);try{for(u.s();!(c=u.n()).done;){var h=c.value;o.push(this.renderItem(h))}}catch(d){u.e(d)}finally{u.f()}t.push(Object(b.jsx)(g,{header:"Floor ".concat(s),expanded:!1,children:o}))}return t}},{key:"render",value:function(){var e=this.props.sweepData;return Object(b.jsx)("div",{className:"menu",children:Object(b.jsx)(w,{header:"Sweeps (".concat(e.length,")"),children:this.renderGroups()})})}}]),n}(r.Component);function N(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)+Math.pow(e.z-t.z,2))}function M(e,t){return t[e].position}var C=function(){function e(t){var n=this;Object(h.a)(this,e),this.VERT_THRESHOLD=.5,this.HORZ_THRESHOLD=10,this.graph={},this.path=[],this.sweepPositions={},t.map((function(e){return n.sweepPositions[e.sid]=e.position})),this.createGraph(t)}return Object(d.a)(e,[{key:"createGraph",value:function(e){for(var t={},n=0;n<e.length;n++){for(var r=e[n],a={},s=r.neighbors,i=0;i<s.length;i++){var c=s[i],o=N(r.position,this.sweepPositions[c]);a[c]=o}t[r.sid]=a}this.graph=t}},{key:"heuristic",value:function(e,t){var n=this.sweepPositions;return N(n[e],n[t])}},{key:"penalty",value:function(e,t){var n=this.sweepPositions;return Math.pow((n[e].y-n[t].y)/this.VERT_THRESHOLD,4)+(Math.pow(n[e].x-n[t].x,2)+Math.pow(n[e].z-n[t].z,2))/this.HORZ_THRESHOLD}},{key:"findShortestPath",value:function(){var e=Object(u.a)(o.a.mark((function e(t,n){var r,a,s,i,c,u,p,h,d,l,f,v,b,j;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(r=this.graph)[t]&&void 0!==r[n]){e.next=4;break}return console.error("Sweep SID(s) is invalid."),e.abrupt("return");case 4:(a={})[t]={visited:!1,distance:0,cost:0,parent:null},s=0;case 7:for(s+=1,i=void 0,c=Object.keys(a),u=0;u<c.length;u++)p=c[u],!a[p].visited&&(void 0===i||a[p].cost<a[i].cost)&&(i=p);if(void 0!==i){e.next=15;break}return console.error("Could not find path; sweeps are not connected."),e.abrupt("return");case 15:if(i!==n){e.next=17;break}return e.abrupt("break",22);case 17:for(a[i].visited=!0,h=Object.keys(r[i]),d=0;d<h.length;d++)l=h[d],f=a[i].distance+r[i][l],v=f+this.penalty(i,l)+this.heuristic(l,n),l in a?!a[l].visited&&a[l].cost>v&&(a[l].parent=i,a[l].distance=f,a[l].cost=v):a[l]={visited:!1,distance:f,cost:v,parent:i};e.next=7;break;case 22:for(console.log("Pathfind iterations: ".concat(s)),j=[b=n];null!==a[b].parent;)b=a[b].parent,j.push(b);return j.reverse(),e.abrupt("return",j);case 28:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),P=function e(){var t=this;Object(h.a)(this,e),this.material=void 0,this.inputs={visible:!1,path:[],radius:.15,color:65280,opacity:.5,heightOffset:-1.1,stepMultiplier:5},this.context=void 0,this.outputs={curve:null,distance:0},this.onInit=Object(u.a)(o.a.mark((function e(){var n,r,a,s,i,c,u,p,h,d,l,f,v,b,j;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.context.three,r=t.inputs,a=r.path,s=r.radius,i=r.heightOffset,c=r.opacity,u=r.color,p=r.stepMultiplier,!(a.length<2)&&a.every((function(e){return!!e}))){e.next=4;break}return e.abrupt("return");case 4:h=0,d=a.map((function(e,t){return t>0&&(h+=N(a[t-1],e)),new n.Vector3(e.x,e.y+i,e.z)})),l=new n.CatmullRomCurve3(d),f={steps:p*a.length,bevelEnabled:!1,extrudePath:l},v=(new n.Shape).absarc(0,0,s,0,2*Math.PI,!1),b=new n.ExtrudeGeometry(v,f),t.material=new n.MeshBasicMaterial({color:u,transparent:!0,opacity:c}),j=new n.Mesh(b,t.material),t.outputs.objectRoot=j,t.outputs.curve=l,t.outputs.distance=h;case 15:case"end":return e.stop()}}),e)}))),this.onEvent=function(e,t){},this.onInputsUpdated=function(e){},this.onTick=function(e){},this.onDestroy=function(){var e;null===(e=t.material)||void 0===e||e.dispose()}},I="sdk-component.pathRenderer";function D(){return new P}var T=function e(){var t=this;Object(h.a)(this,e),this.startTime=void 0,this.length=void 0,this.up=void 0,this.inputs={curve:null,speed:1,verticalOffset:1},this.context=void 0,this.outputs={camera:null},this.onInit=Object(u.a)(o.a.mark((function e(){var n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.context.three,console.log("start"),r=new n.PerspectiveCamera(45,1.333,1,1e3),t.outputs.camera=r,r.position.copy(t.inputs.curve.getPoint(0)),r.position.y+=t.inputs.verticalOffset,r.updateProjectionMatrix(),t.startTime=Date.now(),t.length=t.inputs.curve.getLength(),t.up=new n.Vector3(0,1,0);case 10:case"end":return e.stop()}}),e)}))),this.onEvent=function(e,t){},this.onInputsUpdated=function(e){},this.onTick=function(){var e=Object(u.a)(o.a.mark((function e(n){var r,a,s,i,c,u,p,h;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.context.three,a=(Date.now()-t.startTime)/1e3,s=t.inputs.speed*a/t.length,i=t.inputs.speed*(a+1)/t.length,c=t.inputs.curve.getPointAt(s),u=t.inputs.curve.getPointAt(i),t.outputs.camera.position.copy(c),t.outputs.camera.position.y+=1,p=(new r.Matrix4).lookAt(c,u,t.up),h=(new t.context.three.Quaternion).setFromRotationMatrix(p),t.outputs.camera.quaternion.copy(h),t.outputs.camera.updateProjectionMatrix();case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onDestroy=function(){}},E="sdk-component.cameraController";function R(){return new T}var H=function(){var e=Object(u.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([t.Scene.register(I,D),t.Scene.register(E,R)]);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),F={m:"opSBz3SgMg3",applicationKey:"q44m20q8yk81yi0qgixrremda",title:"0",qs:"1",hr:"0",brand:"0",help:"0",play:"1"},L=function(e){Object(l.a)(n,e);var t=Object(f.a)(n);function n(e){var r;Object(h.a)(this,n),(r=t.call(this,e)).src=void 0,r.sdk=void 0,r.pathNode=void 0,r.path=void 0,r.pathfinder=void 0,r.flyNode=void 0,r.onOptionSelect=function(e){r.setState({selectedSweepId:e})};var a=r.handleUrlParams();return r.src="".concat("/sdk_pathfinder","/bundle/showcase.html?").concat(a),r.state={sweepData:[]},r}return Object(d.a)(n,[{key:"handleUrlParams",value:function(){for(var e=new URLSearchParams(window.location.search),t=0,n=Object.entries(F);t<n.length;t++){var r=Object(p.a)(n[t],2),a=r[0],s=r[1];e.has(a)||e.append(a,""+s)}return e.toString()}},{key:"componentDidMount",value:function(){var e=Object(u.a)(o.a.mark((function e(){var t,n=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v("showcase",F.applicationKey);case 2:return this.sdk=e.sent,e.next=5,H(this.sdk);case 5:return e.next=7,this.sdk.Model.getData();case 7:t=e.sent.sweeps,this.pathfinder=new C(t),this.setState({sweepData:t}),this.sdk.Sweep.data.subscribe({onCollectionUpdated:function(e){n.setState({sweepMap:e})}}),this.sdk.Sweep.current.subscribe((function(e){n.setState({currSweepId:e.sid})}));case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){this.handlePath()}},{key:"handlePath",value:function(){var e=Object(u.a)(o.a.mark((function e(){var t,n,r,a,s,i,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.state,n=t.currSweepId,r=t.selectedSweepId,a=t.sweepMap,s=this.sdk,i=this.pathfinder,!(s&&a&&n&&r&&i)){e.next=14;break}return e.next=5,i.findShortestPath(n,r);case 5:if(c=e.sent){e.next=8;break}return e.abrupt("return");case 8:return this.pathNode&&this.pathNode.stop(),e.next=11,s.Scene.createNode();case 11:this.pathNode=e.sent,this.path=this.pathNode.addComponent(I,{path:c.map((function(e){return M(e,a)})),opacity:.7,radius:.12,stepMultiplier:10,color:9303907}),this.pathNode.start();case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"startFly",value:function(){var e=Object(u.a)(o.a.mark((function e(){var t,n,r,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.sdk,n=this.path,!t||!n){e.next=15;break}return this.endFly(),e.next=5,t.Scene.createNode();case 5:return this.flyNode=e.sent,e.next=8,this.flyNode.addComponent(E);case 8:return r=e.sent,a=this.flyNode.addComponent("mp.camera",{enabled:!0}),r.bind("curve",n,"curve"),a.bind("camera",r,"camera"),e.next=14,t.Mode.moveTo(t.Mode.Mode.DOLLHOUSE,{transition:t.Mode.TransitionType.INSTANT});case 14:this.flyNode.start();case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"endFly",value:function(){var e=Object(u.a)(o.a.mark((function e(){var t,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.sdk,n=this.flyNode,t&&n&&n.stop();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state,n=t.currSweepId,r=t.selectedSweepId,a=t.sweepData;return Object(b.jsxs)("div",{className:"app",children:[Object(b.jsx)(j,{src:this.src}),Object(b.jsxs)("div",{className:"fly-buttons",children:[Object(b.jsx)("button",{onClick:function(){return e.startFly()},children:"Start Fly"}),Object(b.jsx)("button",{onClick:function(){return e.endFly()},children:"End Fly"})]}),Object(b.jsx)(S,{currSweepId:n,selectedSweepId:r,sweepData:a,onChange:this.onOptionSelect})]})}}]),n}(r.Component);i.a.render(Object(b.jsx)(a.a.StrictMode,{children:Object(b.jsx)(L,{})}),document.getElementById("root"))}},[[27,1,2]]]);
//# sourceMappingURL=main.369835cf.chunk.js.map